{% extends "templates/base.html" %}
{% from "templates/base.html" import message_box %}

{% block title %}Aluno{% endblock %}

{% macro form_input(value, id, text, placeholder, validation="", required=False, extra="") -%}
  <div class="form-group">
    <label for="{{ id }}" class="col-sm-2 control-label">{{ text }}{% if required %}*{% endif %}</label>
    <div class="col-sm-10">
      <input type="text" class="form-control" id="{{ id }}" name="{{ id }}" placeholder="{{ placeholder }}"
             {% if value %}value="{{ value }}"{% endif %}
             data-validation="{{ validation }}" {{ extra }} {% if required %}required{% endif %}>
    </div>
  </div>
{%- endmacro %}

{% block content %}
  <div>
    <a href="/alunos" class="btn btn-default" role="button"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span></a>&nbsp;&nbsp;Voltar para todos os alunos
  </div>
  <hr>
  {{ message_box(message, message_type) }}

  {% if show_form %}
  <form class="form-horizontal" action="/aluno/{{id}}" method="POST">
    {{ form_input(student and student.name,            "name",            "Nome",                     "Nome",                "required",        required=True                              ) }}
    {{ form_input(student and student.surname,         "surname",         "Sobrenome",                "Sobrenome"                                                                          ) }}
    {{ form_input(student and student.telephones,      "telephones",      "Telefone",                 "(61) 98888-7777",     "brphone",         required=True                              ) }}
    {{ form_input(student and student.email,           "email",           "Email",                    "alguem@email.com",    "email"                                                       ) }}
    {{ form_input(student and student.languages,       "languages",       "Idiomas interessados",     "Alemão, inglês, ..."                                                                ) }}
    {{ form_input(student and student.status,          "status",          "Status",                   "Interessado..."                                                                     ) }}
    {{ form_input(student and student.first_contact,   "first_contact",   "Data do primeiro contato", "dd/mm/aaaa",          "date dategt1900", extra='data-validation-format=dd/mm/yyyy') }}
    <hr>
    {{ form_input(student and student.modalities,      "modalities",      "Modalidades",              "Aula regular..."                                                                    ) }}
    {{ form_input(student and student.made_test,       "made_test",       "Fez teste de nivelamento", "Sim/Não"                                                                            ) }}
    {{ form_input(student and student.available_times, "available_times", "Horários disponíveis",     "Terça e quinta à tarde..."                                                          ) }}
    {{ form_input(student and student.obs,             "obs",             "Observações adicionais",   "Não gosta de jogos de azar..."                                                   ) }}
    <hr>
    {{ form_input(student and student.lvl,             "lvl",             "Nível",                    "Básico"                                                                             ) }}
    {{ form_input(student and student.turma,           "turma",           "Turma",                    "IB01"                                                                               ) }}
    {{ form_input(student and student.extra_info,      "extra_info",      "Informações matriculados", "RG, CPF, etc"                                                                       ) }}

    <div class="form-group">
      <div class="col-sm-offset-2 col-sm-10">
        <button type="submit" class="btn btn-primary" name="edit">{% if student %} Atualizar {% else %} Criar {% endif %}</button>
        {% if student %}
          <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#confirmation-modal">Remover</button>

          <div class="modal fade" id="confirmation-modal" tabindex="-1" role="dialog" aria-labelledby="confirmation-modal-title">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-label="Fechar"><span aria-hidden="true">&times;</span></button>
                  <h4 class="modal-title" id="confirmation-modal-title">Confirmação</h4>
                </div>
                <div class="modal-body">
                  <p>Tem certeza que deseja remover este aluno?</p>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                  <button type="submit" class="btn btn-danger" name="delete">Remover</button>
                </div>
              </div>
            </div>
          </div>
        {% endif %}
      </div>
    </div>
  </form>
  {% endif %}
{% endblock %}

{% block js %}
  <script src="https://rawgit.com/RobinHerbots/Inputmask/3.x/dist/jquery.inputmask.bundle.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-form-validator/2.3.26/jquery.form-validator.min.js"></script>
  <script>
    $(function(){
      $("#first_contact").inputmask("99/99/9999");
      $("#telephones").inputmask({
        mask: "(99) 9999[9]-9999",
        onincomplete: function() {
          if (/\d_$/.test(this.value)) {
            var unmasked = this.inputmask.unmaskedvalue();
            this.value = unmasked.slice(0, -4) + "-" + unmasked.slice(-4);
            $(this).validate();
          }
        },
      });

      $.formUtils.addValidator({
        name : "dategt1900",
        validatorFunction : function(value, $el, config, language, $form) {
            return parseInt(value.split("/")[2]) >= 1900;
        },
        errorMessage : "O ano deve ser maior ou igual a 1900",
        errorMessageKey: "dategt1900"
      });

      $.validate({
        modules: "date, brazil",
        lang: "pt"
      });
    });
  </script>
{% endblock %}
